@startuml
participant ":FinTrack" as FT
participant ":Parser" as P
participant ":CsvStorage" as CS
participant ":FinanceManager" as FM
participant ":Ui" as UI

FT -> UI: waitForInput()
UI --> FT: "export data.csv"

FT -> P: returnFirstWord(input)
P --> FT: "export"

FT -> P: parseExport(input)
P -> P: validate path format
P -> P: ensure .csv extension
P --> FT: exportPath

create CS
FT -> CS: new CsvStorage()

FT -> FM: getIncomesView()
FT -> FM: getExpensesView()
FT -> FM: getTotalIncome()
FT -> FM: getTotalExpense()
FT -> FM: getBalance()

FT -> CS: export(exportPath, incomes, expenses,\ntotalIncome, totalExpense, balance)

CS -> CS: createDirectories(parentDir)

loop for each income
    CS -> CS: writeIncomeLine(income)
end

loop for each expense
    CS -> CS: writeExpenseLine(expense)
end

CS -> CS: writeSummarySection(totalIncome,\ntotalExpense, balance)

CS --> FT: success

FT -> UI: printExportSuccess(exportPath)

group Exception Handling
    FT -> UI: printError(message)
end
@enduml
