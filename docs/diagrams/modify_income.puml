@startuml
participant "<<class>>\nFinTrack" as FT
participant "<<class>>\nParser" as P
participant ":FinanceManager" as FM
participant "<<class>>\nUi" as UI

FT -> UI: waitForInput()
UI --> FT: "modify-income 3 a/5200 c/SALARY"

FT -> P: returnFirstWord(input)
P --> FT: "modify-income"

FT -> P: parseModifyIncome(input)
P -> P: extract index from args
P -> P: validate index is positive number
P -> P: parse optional fields (amount, category, date, description) into updates map
P --> FT: Map.Entry<index, updates>

FT -> FM: modifyIncome(index, updates)

FM -> FM: oldIncome = deleteIncome(index)

alt index is invalid or list is empty
    FT -> UI: printError(message)
else index is valid
    FM -> FM: mergedIncome = mergeIncome(oldIncome, updates)
    FM -> FM: addIncome(mergedIncome)

    opt adding merged income fails
        FM -> FM: restore old income
        FT -> UI: printError(message)
    end

    FT -> UI: printIncomeModified(mergedIncome, index)
end
@enduml
